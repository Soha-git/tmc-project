FROM golang:1.17.7-alpine3.14 as build

RUN mkdir /src

COPY . /src

WORKDIR /src
RUN go mod download && \
    CGO_ENABLED=0 go build -o main . 


FROM alpine:3.14 as base

RUN apk add ca-certificates &&\
    mkdir /app &&\
    adduser -D go-app
COPY  --from=build /src/main /app/main 

RUN  chown -R go-app:go-app /app/
WORKDIR /app
EXPOSE 80

ENTRYPOINT [ "./main" ]